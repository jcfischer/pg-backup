---
# Configure systemd service and timer

- name: Deploy systemd service file
  ansible.builtin.template:
    src: pg-backup.service.j2
    dest: /etc/systemd/system/pg-backup.service
    owner: root
    group: root
    mode: '0644'
  become: true
  notify:
    - Reload systemd
    - Restart pg-backup timer

- name: Deploy systemd timer file
  ansible.builtin.template:
    src: pg-backup.timer.j2
    dest: /etc/systemd/system/pg-backup.timer
    owner: root
    group: root
    mode: '0644'
  become: true
  notify:
    - Reload systemd
    - Restart pg-backup timer

- name: Flush handlers to reload systemd
  ansible.builtin.meta: flush_handlers

- name: Enable and start pg-backup timer
  ansible.builtin.systemd:
    name: pg-backup.timer
    state: started
    enabled: true
    daemon_reload: true
  become: true
